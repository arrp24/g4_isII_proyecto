<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui">
<h:body>
	<ui:composition template="../../template/common/layout.xhtml">
		<ui:define name="title">LOG :: Edición Usuarios</ui:define>
		<ui:define name="content">
			<h2 class="ui-state-default">Edición de Usuario</h2>
			<h:form id="formEdit">
				<p:growl id="growl" showDetail="true" escape="false" />
				<p:tooltip />
				<p:dataTable id="dataTable" var="usuario" value="#{usuarioBacking.usuarios}" paginator="true" rows="5"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					rowsPerPageTemplate="5,10,15">

					<p:column>
						<p:splitButton id="splitBtn" value="Editar" title="Haz clic para editar el Usuario actual"
							update=":formEdit :frmEditUsuario" oncomplete="dlgEditUsuario.show()" icon="ui-icon-pencil">
							<f:setPropertyActionListener value="#{usuario}" target="#{usuarioBacking.selectedUsuario}" />
							<p:menuitem value="Eliminar" onclick="confirmation.show()" icon="ui-icon-trash">
								<f:setPropertyActionListener value="#{usuario}" target="#{usuarioBacking.selectedUsuario}" />
							</p:menuitem>
						</p:splitButton>
					</p:column>

				<!-- 	<p:column headerText="Código" sortBy="#{usuario.id}" filterBy="#{usuario.id}" filterMatchMode="contains">
						<h:outputText value="#{usuario.id}" />
					</p:column> -->

					
					<p:column sortBy="#{usuario.cedula}" headerText="Cédula" filterBy="#{usuario.cedula}" filterMatchMode="contains">
						<h:outputText value="#{usuario.cedula}" />
					</p:column>

					<p:column sortBy="#{usuario.nombre}" headerText="Nombre" filterBy="#{usuario.nombre}" filterMatchMode="contains">
						<h:outputText value="#{usuario.nombre}" />
					</p:column>

					<p:column headerText="Roles">
						<p:commandButton id="btnVerRoles" update=":formEdit :frmEditRolesPorUsu" oncomplete="dlgRoles.show()"
							icon="ui-icon-search" title="Haga clic para editar los roles del usuario">
							<f:setPropertyActionListener value="#{usuario}" target="#{usuarioBacking.selectedUsuario}" />
							<f:setPropertyActionListener value="#{usuario}" target="#{rolPorUsuarioBacking.selectedUsuario}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>

				<br />
				<p:commandButton id="btnNuevoUsuario" icon="ui-icon-plusthick" title="Haz clic para agregar un nuevo Usuario"
					onclick="dlgNuevoUsuario.show();" value="Nuevo" />

				<p:confirmDialog id="confirmDialog" message="Estas seguro que deseas borrar el usuario actual?"
					header="Confirma tu acción" severity="alert" widgetVar="confirmation">
					<p:commandButton id="confirm" value="Si" update=":formEdit :frmNuevoUsuario" oncomplete="confirmation.hide()"
						actionListener="#{usuarioBacking.eliminarUsuario()}" />
					<p:commandButton id="decline" value="No" onclick="confirmation.hide()" type="button" />
				</p:confirmDialog>

			</h:form>

			<h:form id="frmEditRolesPorUsu">
				<p:growl id="growl" showDetail="true" escape="false" />
				<p:dialog id="dialogoRoles" widgetVar="dlgRoles" modal="true" resizable="false"
					header="Roles del Usuario #{rolPorUsuarioBacking.selectedUsuario.nombre}">

					<p:wizard widgetVar="wiz" id="wizardRoles" styleClass="wizardTopMargin"
						flowListener="#{usuarioBacking.onFlowProcess}">

						<p:tab id="asignacionRoles" title="Asignación de Roles">
							<p:outputLabel value="Si no se asigna una clave para el rol, la clave por defecto será la cédula del usuario"
								styleClass="ui-messages-info ui-corner-all" style="font-size:0.6em;" />
							<p:pickList value="#{usuarioBacking.rolPorUsuario}" var="rol" itemValue="#{rol}" itemLabel="#{rol.id}"
								converter="#{rolConvertor}" style="margin-top:15px;">
								<f:facet name="sourceCaption">Disponibles</f:facet>
								<f:facet name="targetCaption">Asignados</f:facet>
							</p:pickList>
							<p:commandButton id="btnCancelarRoles" value="Cancelar" onclick="dlgRoles.hide()" />
							<p:commandButton id="btnListoAsignacion" value="Listo"
								actionListener="#{usuarioBacking.guardarAsignacionRolPorUsuario()}" update=":formEdit :frmEditRolesPorUsu" />
						</p:tab>

						<p:tab id="tabRoles" title="Información Roles">
							<p:panel rendered="#{rolPorUsuarioBacking.selectedUsuario.tieneRoles()}">
								<p:carousel id="carousel" value="#{rolPorUsuarioBacking.selectedUsuario.rolPorUsuarios}" var="rolPorUsuario"
									headerText="" numVisible="1" itemStyle="width:400px">
									<h:panelGrid columns="2" style="width:100%" cellpadding="5">
										<h:outputText value="Rol: " />
										<h:outputText value="#{rolPorUsuario.id.rolId}" />
										<h:outputText value="Descripción: " />
										<h:outputText value="#{rolPorUsuario.rol.descripcion}" />
									</h:panelGrid>
									<br />
									<p:commandButton title="Ver Detalle" id="btnVerDetalleRol" icon="ui-icon-pencil" update=":
"
										oncomplete="dlgDetalleRol.show()" value="Detalle">
										<f:setPropertyActionListener value="#{rolPorUsuario}" target="#{rolPorUsuarioBacking.selectedRolPorUsuario}" />
										<f:setPropertyActionListener value="#{rolPorUsuario.clave}" target="#{rolPorUsuarioBacking.selectedClave}" />
									</p:commandButton>
								</p:carousel>
							</p:panel>
							<p:panel rendered="#{!rolPorUsuarioBacking.selectedUsuario.tieneRoles()}" style="width:650px;">
								<p:outputLabel value="Este usuario no tiene roles asignados, presiones BACK para asignarle roles."
									styleClass="ui-messages-error ui-corner-all"  escape="false"/>
							</p:panel>
							<p:commandButton id="btnListoFinWiz" value="Listo" update=":frmEditRolesPorUsu" onclick="dlgRoles.hide()" />
						</p:tab>
					</p:wizard>
				</p:dialog>
			</h:form>

			<h:form id="frmDetalleRol">
				<p:dialog id="dialogoDetalleRol" widgetVar="dlgDetalleRol" modal="true" resizable="false"
					header="Detalle del rol #{rolPorUsuarioBacking.selectedRolPorUsuario.id.rolId} : #{rolPorUsuarioBacking.selectedRolPorUsuario.usuario.nombre}">
					<p:outputLabel value="Si se deja en blanco la clave se mantendrá la clave antigua"
						styleClass="ui-messages-info ui-corner-all" style="font-size:0.6em; margin-top:15px;" />
					<h:panelGrid columns="2" cellpadding="5" style="margin-top:10px;">
						<h:outputText value="Clave: " />
						<p:password id="claveRol" value="#{rolPorUsuarioBacking.selectedRolPorUsuario.clave}" match="claveRol2"
							label="Clave" />

						<h:outputLabel value="Confirma Clave:" />
						<p:password id="claveRol2" value="#{rolPorUsuarioBacking.selectedRolPorUsuario.clave}" label="Confirma Clave" />

						<h:outputText value="Estado: " />
						<p:selectOneButton value="#{rolPorUsuarioBacking.selectedRolPorUsuario.estado}">
							<f:selectItem itemLabel="Activo" itemValue="1" />
							<f:selectItem itemLabel="Inactivo" itemValue="0" />
						</p:selectOneButton>

						<h:outputText value="Inicio Vigencia: " />
						<p:outputLabel id="fechaIniVig" value="#{rolPorUsuarioBacking.selectedRolPorUsuario.fechaInicioVigencia}" />
						<f:facet name="footer">
							<p:commandButton id="btnGuardarNuevo" value="Guardar"
								actionListener="#{rolPorUsuarioBacking.actualizarDetalleRolPorUsuario()}"
								update=":frmNuevoUsuario :formEdit :frmDetalleRol" />
							<p:commandButton id="btnCancelarNuevo" value="Cancelar" onclick="dlgDetalleRol.hide()" />
						</f:facet>
					</h:panelGrid>
				</p:dialog>
			</h:form>

			<h:form id="frmNuevoUsuario">
				<p:dialog id="dialogoNuevoUsuario" widgetVar="dlgNuevoUsuario" modal="true" resizable="false"
					header="Creación Nuevo Usuario">
					<h:panelGrid columns="2" cellpadding="5">

						
						<h:outputLabel for="txtCedulaNU" value="Cédula: *" />
						<p:inputText id="txtCedulaNU" label="Cédula" value="#{usuarioBacking.usuario.cedula}" required="true" />

						<h:outputLabel for="txtNombreNU" value="Nombre: *" />
						<p:inputText id="txtNombreNU" label="Nombre" value="#{usuarioBacking.usuario.nombre}" required="true" />

						<h:outputLabel for="txtTelefonoNU" value="Teléfono: *" />
						<p:inputText id="txtTelefonoNU" label="Teléfono" value="#{usuarioBacking.usuario.telefono}" required="true" />

						<h:outputLabel for="txtMailNU" value="Mail: *" />
						<p:inputText id="txtMailNU" label="Mail" value="#{usuarioBacking.usuario.mail}" required="true" />

						<!-- <h:outputLabel for="spnCostoHombreNU" value="Costo Hombre: *" />
						<p:spinner id="spnCostoHombreNU" value="#{usuarioBacking.usuario.costoHombre}" prefix="$" min="0" required="true" />


						<h:outputLabel for="cldFechaNacimientoNU" value="Fecha Nacimiento: *" />
						<p:calendar id="cldFechaNacimientoNU" value="#{usuarioBacking.usuario.fechaNacimiento}" pattern="yyy-MM-dd"
							navigator="true" required="true" />

						<h:outputLabel for="txtDepartamentoNU" value="Departamento: *" />
						<p:inputText id="txtDepartamentoNU" label="departamento" value="#{usuarioBacking.usuario.departamento}"
							required="true" />

						<h:outputLabel for="txtDemarcacionNU" value="Demarcación: *" />
						<p:inputText id="txtDemarcacionNU" label="demarcacion" value="#{usuarioBacking.usuario.demarcacion}"
							required="true" />

						<h:outputLabel for="txtFechaCreacionNU" value="Fecha Creación:" />
						<p:inputText id="txtFechaCreacionNU" label="fechaCreacion" disabled="true" value="#{usuarioBacking.fechaHoy}" /> -->

						<f:facet name="footer">
							<p:commandButton id="btnGuardarNuevo" value="Guardar" actionListener="#{usuarioBacking.crearUsuario()}"
								update=":frmNuevoUsuario :formEdit" />
							<p:commandButton id="btnCancelarNuevo" value="Cancelar" onclick="dlgNuevoUsuario.hide()" />
						</f:facet>
					</h:panelGrid>
				</p:dialog>
			</h:form>
			<h:form id="frmEditUsuario">
				<p:dialog id="dialogoEditUsuario" widgetVar="dlgEditUsuario" modal="true" resizable="false"
					header="Edición de Usuario">
					<h:panelGrid columns="2" cellpadding="5">

				
						<h:outputLabel for="txtCedulaEU" value="Cédula: *" />
						<p:inputText id="txtCedulaEU" label="Cédula" value="#{usuarioBacking.selectedUsuario.cedula}" required="true" />

						<h:outputLabel for="txtNombreEU" value="Nombre: *" />
						<p:inputText id="txtNombreEU" label="Nombre" value="#{usuarioBacking.selectedUsuario.nombre}" required="true" />

						<h:outputLabel for="txtTelefonoEU" value="Teléfono: *" />
						<p:inputText id="txtTelefonoEU" label="Teléfono" value="#{usuarioBacking.selectedUsuario.telefono}"
							required="true" />

						<h:outputLabel for="txtMailEU" value="Mail: *" />
						<p:inputText id="txtMailEU" label="Mail" value="#{usuarioBacking.selectedUsuario.mail}" required="true" />

						<!-- <h:outputLabel for="spnCostoHombreEU" value="Costo Hombre: *" />
						<p:spinner id="spnCostoHombreEU" value="#{usuarioBacking.selectedUsuario.costoHombre}" prefix="$" min="0"
							required="true" />


						<h:outputLabel for="cldFechaNacimientoEU" value="Fecha Nacimiento: *" />
						<p:calendar id="cldFechaNacimientoEU" value="#{usuarioBacking.selectedUsuario.fechaNacimiento}"
							pattern="yyy-MM-dd" navigator="true" required="true" />

						<h:outputLabel for="txtDepartamentoEU" value="Departamento: *" />
						<p:inputText id="txtDepartamentoEU" label="departamento" value="#{usuarioBacking.selectedUsuario.departamento}"
							required="true" />

						<h:outputLabel for="txtDemarcacionEU" value="Demarcación: *" />
						<p:inputText id="txtDemarcacionEU" label="demarcacion" value="#{usuarioBacking.selectedUsuario.demarcacion}"
							required="true" />

						<h:outputLabel for="txtFechaCreacionEU" value="Fecha Creación:" />
						<p:inputText id="txtFechaCreacionEU" label="fechaCreacion" disabled="true" value="#{usuarioBacking.fechaHoy}" />
 -->
						<f:facet name="footer">
							<p:commandButton id="btnGuardarEdicion" value="Guardar" actionListener="#{usuarioBacking.actualizarUsuario()}"
								update=":frmEditUsuario :formEdit" />
							<p:commandButton id="btnCancelarEdicion" value="Cancelar" onclick="dlgEditUsuario.hide()" />
						</f:facet>
					</h:panelGrid>
				</p:dialog>
			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>