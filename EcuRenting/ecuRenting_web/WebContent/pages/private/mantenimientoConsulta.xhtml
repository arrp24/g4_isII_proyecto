<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui">
<h:body>
	<ui:composition template="../../template/common/layout.xhtml">
		<ui:define name="title">LOG :: Consulta Mantenimiento</ui:define>
		<ui:define name="content">
			<h2 class="ui-state-default">Consulta de Mantenimientos</h2>
			
			
		<p:scrollPanel style="width:1025px;height:515px">
			<h:form id="formEdit">
			<p:confirmDialog id="confirmDialog" message="Estas seguro que deseas borrar el mantenimiento actual?"
					header="Confirma tu acción" severity="alert" widgetVar="confirmation">
					<p:commandButton id="confirm" value="Si" update=":formEdit :frmEditMantenimiento" oncomplete="confirmation.hide()"
						actionListener="#{mantenimientoBacking.eliminarMantenimiento()}" />
					<p:commandButton id="decline" value="No" onclick="confirmation.hide()" type="button" />
			</p:confirmDialog>
			<p:growl id="growl" showDetail="true" escape="false" />
				<p:dataTable id="dataTable" var="mantenimiento" value="#{mantenimientoBacking.mantenimientos}" paginator="true" rows="5"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
					
					<p:column>
						<p:splitButton id="splitBtn" value="Editar" title="Haz clic para agendar un mantenimiento"
							update=":formEdit :frmEditMantenimiento" oncomplete="dlgEditMantenimiento.show()" icon="ui-icon-pencil">
							<f:setPropertyActionListener value="#{mantenimiento}" target="#{mantenimientoBacking.selectedMantenimiento}" />
							<p:menuitem value="Eliminar" onclick="confirmation.show()" icon="ui-icon-trash">
								<f:setPropertyActionListener value="#{mantenimiento}" target="#{mantenimientoBacking.selectedMantenimiento}"  />
							</p:menuitem>
						</p:splitButton>
					</p:column>

					<p:column sortBy="#{mantenimiento.placa}" headerText="Placa" filterBy="#{mantenimiento.placa}" filterMatchMode="contains">
						<h:outputText value="#{mantenimiento.placa}" />
					</p:column>
					
						
					<p:column sortBy="#{mantenimiento.fechaUltimo}" headerText="Fecha Último" >
						<h:outputText value="#{mantenimiento.fechaUltimo}" />
					</p:column>

					<p:column sortBy="#{mantenimiento.fechaSiguiente}" headerText="Fecha Siguiente" >
						<h:outputText value="#{mantenimiento.fechaSiguiente}" />
					</p:column>
					
					<p:column sortBy="#{mantenimiento.km}" headerText="Kilometros" filterBy="#{mantenimiento.km}"
						filterMatchMode="contains">
						<h:outputText value="#{mantenimiento.km}" />
					</p:column>
					<p:column sortBy="#{mantenimiento.responsable}" headerText="Responsable" filterBy="#{mantenimiento.responsable}"
						filterMatchMode="contains">
						<h:outputText value="#{mantenimiento.responsable}" />
					</p:column>
					<p:column headerText="Historial">
					
					<p:commandButton id="btnCargar" update=":formEdit :frmHistorial" value="Ver"  oncomplete="dlgHistorial.show()" title="Haz clic para ver el historial de mantenimiento"
							icon="ui-icon-circle-plus" >
						<f:setPropertyActionListener value="#{mantenimiento}" target="#{mantenimientoBacking.selectedMantenimiento}" />
					</p:commandButton>					
					</p:column>
					
				</p:dataTable>
				<p:commandButton id="btnNuevoMantenimiento" icon="ui-icon-plusthick" title="Haz clic para agregar un nuevo mantenimiento"
					onclick="dlgNuevoMantenimiento.show();" value="Nuevo" />
			</h:form>
		</p:scrollPanel>
			
		<h:form id="frmHistorial">
			
				<p:dialog id="dialogoHistorial" widgetVar="dlgHistorial" modal="true" resizable="false"
					header="Historial de mantenimiento">
			<p:scrollPanel style="width:950px;height:425px">
				<p:dataTable id="dataTableHistorial" var="historial" value="#{mantenimientoBacking.historialMantenimientos}" paginator="true" rows="10"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					rowsPerPageTemplate="5,10,15">

					
					<p:column sortBy="#{historial.placa}" headerText="Placa" >
						<h:outputText value="#{historial.placa}" />
					</p:column>
					
					<p:column sortBy="#{historial.fecha}" headerText="Fecha" >
						<h:outputText value="#{historial.fecha}" />
					</p:column>
					
					<p:column sortBy="#{historial.observacion}" headerText="Descripción" >
						<h:outputText value="#{historial.observacion}" />
					</p:column>
					
					<p:column sortBy="#{historial.costo}" headerText="Costo" >
						<h:outputText value="#{historial.costo}" />
					</p:column>
					
					<p:column sortBy="#{historial.tecnicoResponsable}" headerText="Tecnico Responsable" >
						<h:outputText value="#{historial.tecnicoResponsable}" />
					</p:column>
					
					<p:column sortBy="#{historial.estado}" headerText="Estado" >
						<h:outputText value="#{historial.estado}" />
					</p:column>
					
					<p:column sortBy="#{historial.km}" headerText="Kilometraje" 
					filterBy="#{historial.km}" filterMatchMode="contains">
						<h:outputText value="#{historial.km}" />
					</p:column>
				</p:dataTable>
			</p:scrollPanel>
					<h:panelGrid columns="2" cellpadding="5">
						<f:facet name="footer">														
							<p:commandButton id="btnCancelarNuevo" value="Cerrar" onclick="dlgHistorial.hide()" />
						</f:facet>
					</h:panelGrid>
				</p:dialog>
		</h:form>
			
			<h:form id="frmEditMantenimiento">
				<p:dialog id="dialogoEditChofer" widgetVar="dlgEditMantenimiento" modal="true" resizable="false"
					header="Edición de Mantenimiento">
					<h:panelGrid columns="2" cellpadding="5">

						<p:outputLabel for="placaE" value="Placa"  />
						<p:outputLabel id="placaE" value="#{mantenimientoBacking.selectedMantenimiento.placa}" />
									
						<p:outputLabel for="tecnicoRespE" value="Tec. Responsable: "  />
						<p:selectOneMenu id="tecnicoRespE" value="#{mantenimientoBacking.selectedMantenimiento.responsable}" 
                         		effect="fade" var="t"  filter="true" filterMatchMode="startsWith">
				            
				            <f:selectItems value="#{mantenimientoBacking.tecnicos}" var="tecnico" itemLabel="#{tecnico.nombre}: #{tecnico.especialidad}" itemValue="#{tecnico.nombre}" />
				 
				        </p:selectOneMenu>
				        
				        <p:outputLabel for="fechaSiguienteME" value="Fecha: *" />
						<p:calendar id="fechaSiguienteME" value="#{mantenimientoBacking.selectedMantenimiento.fechaSiguiente}" pattern="dd-MM-yyyy" />
						
						<p:outputLabel for="observacionE" value="Observacion: *" />
						<p:inputText id="observacionE" value="#{mantenimientoBacking.selectedMantenimiento.descripcion}" />
						
							
						<f:facet name="footer">
							<p:commandButton id="btnGuardarEdicion" value="Guardar" actionListener="#{mantenimientoBacking.actualizarMantenimiento()}"
								update=":frmEditMantenimiento :formEdit" onclick="dlgEditMantenimiento.hide()" />
								
							<p:commandButton id="btnCancelarEdicion" value="Cancelar" onclick="dlgEditMantenimiento.hide()" />
						</f:facet>
					</h:panelGrid>
				</p:dialog>
			</h:form>
			
			<h:form id="frmNuevoMantenimiento">
			<p:growl id="growl" showDetail="true" escape="false" />
				<p:dialog id="dialogoNuevoMantenimiento" widgetVar="dlgNuevoMantenimiento" modal="true" resizable="false"
					header="Nuevo de Mantenimiento">
					<h:panelGrid columns="2" cellpadding="5">

						<p:outputLabel for="placaN" value="Placa: *"  />
						<p:selectOneMenu id="placaN" value="#{mantenimientoBacking.mantenimiento.placa}" 
                         		effect="fade" var="t"  filter="true" filterMatchMode="startsWith">
				            
				            <f:selectItems value="#{mantenimientoBacking.flotas}" var="flota" itemLabel="#{flota.marca}- #{flota.modelo}: #{flota.placa}" itemValue="#{flota.placa}" />
				 
				        </p:selectOneMenu>
									
						<p:outputLabel for="tecnicoRespN" value="Tec. Responsable: "  />
						<p:selectOneMenu id="tecnicoRespN" value="#{mantenimientoBacking.mantenimiento.responsable}" 
                         		effect="fade" var="t"  filter="true" filterMatchMode="startsWith">
				            
				            <f:selectItems value="#{mantenimientoBacking.tecnicos}" var="tecnico" itemLabel="#{tecnico.nombre}: #{tecnico.especialidad}" itemValue="#{tecnico.nombre}" />
				 
				        </p:selectOneMenu>
				        
				        <p:outputLabel for="fechaSiguienteMN" value="Fecha: *" />
						<p:calendar id="fechaSiguienteMN" value="#{mantenimientoBacking.mantenimiento.fechaSiguiente}" pattern="dd-MM-yyyy" />
						
						<p:outputLabel for="observacionN" value="Observacion: *" />
						<p:inputText id="observacionN" value="#{mantenimientoBacking.mantenimiento.descripcion}" />
						
						<p:outputLabel for="kmN" value="Kms: *" />
						<p:spinner id="kmN" value="#{mantenimientoBacking.mantenimiento.km}" min="0" />
						
							
						<f:facet name="footer">
							<p:commandButton id="btnGuardarNuevo" value="Guardar" actionListener="#{mantenimientoBacking.crearMantenimiento()}"
								update=":frmNuevoMantenimiento :formEdit" onclick="dlgNuevoMantenimiento.hide()"  />
								
							<p:commandButton id="btnCancelarEdicion" value="Cancelar" onclick="dlgNuevoMantenimiento.hide()" />
						</f:facet>
					</h:panelGrid>
				</p:dialog>
			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>